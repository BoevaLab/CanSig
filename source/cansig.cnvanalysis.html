
<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.19: https://docutils.sourceforge.io/" />

    <title>cansig.cnvanalysis package &#8212; CanSig  documentation</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "light";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=796348d33e8b1d947c94" rel="stylesheet">
<link href="../_static/styles/bootstrap.css?digest=796348d33e8b1d947c94" rel="stylesheet">
<link href="../_static/styles/pydata-sphinx-theme.css?digest=796348d33e8b1d947c94" rel="stylesheet">

  
  <link href="../_static/vendor/fontawesome/6.1.2/css/all.min.css?digest=796348d33e8b1d947c94" rel="stylesheet">
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.1.2/webfonts/fa-solid-900.woff2">
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.1.2/webfonts/fa-brands-400.woff2">
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.1.2/webfonts/fa-regular-400.woff2">

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/bootstrap.js?digest=796348d33e8b1d947c94">
<link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=796348d33e8b1d947c94">

    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/sphinx_highlight.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'source/cansig.cnvanalysis';</script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="docsearch:language" content="en">
  </head>
  
  
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="180" data-default-mode="">

  
  
  <a class="skip-link" href="#main-content">Skip to main content</a>

  
  <input type="checkbox" class="sidebar-toggle" name="__primary" id="__primary">
  <label class="overlay overlay-primary" for="__primary"></label>

  
  <input type="checkbox" class="sidebar-toggle" name="__secondary" id="__secondary">
  <label class="overlay overlay-secondary" for="__secondary"></label>

  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
      
<form class="bd-search d-flex align-items-center" action="../search.html" method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search the docs ..." aria-label="Search the docs ..." autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false">
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form>
    </div>
  </div>

  
  <nav class="bd-header navbar navbar-expand-lg bd-navbar" id="navbar-main"><div class="bd-header__inner bd-page-width">
  <label class="sidebar-toggle primary-toggle" for="__primary">
      <span class="fa-solid fa-bars"></span>
  </label>
  <div id="navbar-start">
    
    
  


<a class="navbar-brand logo" href="../index.html">

  
  
  
  
  
  
  

  
  
    <p class="title logo__title">CanSig  documentation</p>
  
</a>
    
  </div>

  
  <div class="col-lg-9 navbar-header-items">
    <div id="navbar-center" class="mr-auto">
      
      <div class="navbar-center-item">
        <nav class="navbar-nav">
    <p class="sidebar-header-items__title" role="heading" aria-level="1" aria-label="Site Navigation">
        Site Navigation
    </p>
    <ul id="navbar-main-elements" class="navbar-nav">
        
                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../preprocessing.html">
                        Preprocessing
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../pipeline-advanced.html">
                        Advanced pipeline usage
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../formatting-data.html">
                        Input data format
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../cansig-for-python-coders.html">
                        CanSig as a package
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../troubleshooting.html">
                        Troubleshooting
                      </a>
                    </li>
                
            <div class="nav-item dropdown">
                <button class="btn dropdown-toggle nav-item" type="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                    More
                </button>
                <div class="dropdown-menu">
                    
                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../contributing.html">
                        Contributing
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../api.html">
                        API
                      </a>
                    </li>
                
                </div>
            </div>
            
    </ul>
</nav>
      </div>
      
    </div>

    <div id="navbar-end">
      
        <div class="navbar-end-item navbar-persistent--container">
          
<button class="btn btn-sm navbar-btn search-button search-button__button" title="Search" aria-label="Search" data-toggle="tooltip">
  <i class="fa-solid fa-magnifying-glass"></i>
</button>
        </div>
      
      
      <div class="navbar-end-item">
        <button class="theme-switch-button btn btn-sm btn-outline-primary navbar-btn rounded-circle" title="light/dark" aria-label="light/dark" data-toggle="tooltip">
    <span class="theme-switch" data-mode="light"><i class="fa-solid fa-sun"></i></span>
    <span class="theme-switch" data-mode="dark"><i class="fa-solid fa-moon"></i></span>
    <span class="theme-switch" data-mode="auto"><i class="fa-solid fa-circle-half-stroke"></i></span>
</button>
      </div>
      
      <div class="navbar-end-item">
        <ul id="navbar-icon-links" class="navbar-nav" aria-label="Icon Links">
        <li class="nav-item">
          
          
          
          
          
          
          
          <a href="https://github.com/BoevaLab/CanSig" title="GitHub" class="nav-link" rel="noopener" target="_blank" data-toggle="tooltip"><span><i class="fab fa-github-square"></i></span>
            <label class="sr-only">GitHub</label></a>
        </li>
      </ul>
      </div>
      
    </div>
  </div>


  
  
    <div class="navbar-persistent--mobile">
<button class="btn btn-sm navbar-btn search-button search-button__button" title="Search" aria-label="Search" data-toggle="tooltip">
  <i class="fa-solid fa-magnifying-glass"></i>
</button>
    </div>
  

  
  <label class="sidebar-toggle secondary-toggle" for="__secondary">
      <span class="fa-solid fa-outdent"></span>
  </label>
  

</div>
  </nav>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      <div class="bd-sidebar-primary bd-sidebar">
        
  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
      <div class="sidebar-header-items__center">
      
      <div class="navbar-center-item">
        <nav class="navbar-nav">
    <p class="sidebar-header-items__title" role="heading" aria-level="1" aria-label="Site Navigation">
        Site Navigation
    </p>
    <ul id="navbar-main-elements" class="navbar-nav">
        
                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../preprocessing.html">
                        Preprocessing
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../pipeline-advanced.html">
                        Advanced pipeline usage
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../formatting-data.html">
                        Input data format
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../cansig-for-python-coders.html">
                        CanSig as a package
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../troubleshooting.html">
                        Troubleshooting
                      </a>
                    </li>
                
            <div class="nav-item dropdown">
                <button class="btn dropdown-toggle nav-item" type="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                    More
                </button>
                <div class="dropdown-menu">
                    
                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../contributing.html">
                        Contributing
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../api.html">
                        API
                      </a>
                    </li>
                
                </div>
            </div>
            
    </ul>
</nav>
      </div>
      
      </div>
    

    
    
    <div class="sidebar-header-items__end">
      
      <div class="navbar-end-item">
        <button class="theme-switch-button btn btn-sm btn-outline-primary navbar-btn rounded-circle" title="light/dark" aria-label="light/dark" data-toggle="tooltip">
    <span class="theme-switch" data-mode="light"><i class="fa-solid fa-sun"></i></span>
    <span class="theme-switch" data-mode="dark"><i class="fa-solid fa-moon"></i></span>
    <span class="theme-switch" data-mode="auto"><i class="fa-solid fa-circle-half-stroke"></i></span>
</button>
      </div>
      
      <div class="navbar-end-item">
        <ul id="navbar-icon-links" class="navbar-nav" aria-label="Icon Links">
        <li class="nav-item">
          
          
          
          
          
          
          
          <a href="https://github.com/BoevaLab/CanSig" title="GitHub" class="nav-link" rel="noopener" target="_blank" data-toggle="tooltip"><span><i class="fab fa-github-square"></i></span>
            <label class="sr-only">GitHub</label></a>
        </li>
      </ul>
      </div>
      
    </div>
    
  </div>

  
  <div class="sidebar-start-items sidebar-primary__section">
    <div class="sidebar-start-items__item"><nav class="bd-links" id="bd-docs-nav" aria-label="Section navigation">
  <p class="bd-links__title" role="heading" aria-level="1">
    Section Navigation
  </p>
  <div class="bd-toc-item navbar-nav">
    <ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="cansig.cluster.html">cansig.cluster package</a></li>
<li class="toctree-l1 current active"><a class="current reference internal" href="#">cansig.cnvanalysis package</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="cansig.integration.html">cansig.integration package</a><input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-1"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="cansig.integration.base.html">cansig.integration.base package</a></li>
<li class="toctree-l2"><a class="reference internal" href="cansig.integration.data.html">cansig.integration.data package</a></li>
<li class="toctree-l2"><a class="reference internal" href="cansig.integration.module.html">cansig.integration.module package</a></li>
<li class="toctree-l2"><a class="reference internal" href="cansig.integration.training.html">cansig.integration.training package</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="cansig.interface.html">cansig.interface package</a></li>
<li class="toctree-l1"><a class="reference internal" href="cansig.metaanalysis.html">cansig.metaanalysis package</a></li>
<li class="toctree-l1"><a class="reference internal" href="cansig.metasignatures.html">cansig.metasignatures package</a></li>
<li class="toctree-l1"><a class="reference internal" href="cansig.models.html">cansig.models package</a></li>
<li class="toctree-l1"><a class="reference internal" href="cansig.plotting.html">cansig.plotting package</a></li>
<li class="toctree-l1"><a class="reference internal" href="cansig.run.html">cansig.run package</a></li>
</ul>

  </div>
</nav>
    </div>
  </div>
  

  
  <div class="sidebar-end-items sidebar-primary__section">
    <div class="sidebar-end-items__item">
    </div>
  </div>

  
  <div id="rtd-footer-container"></div>

      </div>
      <main id="main-content" class="bd-main">
        
        
        <div class="bd-content">
          <div class="bd-article-container">
            
            <div class="bd-header-article">
                
            </div>
            
            
            <article class="bd-article" role="main">
              
  <section id="cansig-cnvanalysis-package">
<h1>cansig.cnvanalysis package<a class="headerlink" href="#cansig-cnvanalysis-package" title="Permalink to this heading">#</a></h1>
<section id="submodules">
<h2>Submodules<a class="headerlink" href="#submodules" title="Permalink to this heading">#</a></h2>
</section>
<section id="module-cansig.cnvanalysis.differentialcnvs">
<span id="cansig-cnvanalysis-differentialcnvs-module"></span><h2>cansig.cnvanalysis.differentialcnvs module<a class="headerlink" href="#module-cansig.cnvanalysis.differentialcnvs" title="Permalink to this heading">#</a></h2>
<p>The submodule implementing utilities for running differential CNV analysis.</p>
<dl class="py function">
<dt class="sig sig-object py" id="cansig.cnvanalysis.differentialcnvs.discretize_cnv">
<span class="sig-prename descclassname"><span class="pre">cansig.cnvanalysis.differentialcnvs.</span></span><span class="sig-name descname"><span class="pre">discretize_cnv</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">data</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">AnnData</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">cnv_key</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">'X_cnv'</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">DataFrame</span></span></span><a class="headerlink" href="#cansig.cnvanalysis.differentialcnvs.discretize_cnv" title="Permalink to this definition">#</a></dt>
<dd><p>This function discretizes the CNV values obtained.
The output of infercnv is a float; during our preprocessing module, these values are
already de-noised to remove spurious calls using the Dynamic Thresholding procedure
as described here <a class="github reference external" href="https://github.com/broadinstitute/inferCNV/wiki/De-noising-Filters">broadinstitute/inferCNV</a>
All remaining positive values are turned into 1 = a gain and all negative values a -1 = a loss
using this function. We thus only gain general gains and losses and do not keep the amplitude
of this gain or loss (ie do not call 2 gains or -2 losses)</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>data</strong> – anndata object with precomputed cluster labels and CNV calls</p></li>
<li><p><strong>cnv_key</strong> – key for the called CNV calls in the .obsm of data</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>dataframe containing the discretized values of the CNV calls
shape (n_cells, n_regions_called)</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="cansig.cnvanalysis.differentialcnvs.find_differential_cnv">
<span class="sig-prename descclassname"><span class="pre">cansig.cnvanalysis.differentialcnvs.</span></span><span class="sig-name descname"><span class="pre">find_differential_cnv</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">data</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">AnnData</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">diff_method</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Literal</span><span class="p"><span class="pre">[</span></span><span class="s"><span class="pre">'mwu'</span></span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="s"><span class="pre">'ttest'</span></span><span class="p"><span class="pre">]</span></span></span></em>, <em class="sig-param"><span class="n"><span class="pre">correction</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">bool</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">subclonal</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">bool</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">batch_key</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">'batch'</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">DataFrame</span></span></span><a class="headerlink" href="#cansig.cnvanalysis.differentialcnvs.find_differential_cnv" title="Permalink to this definition">#</a></dt>
<dd><p>Main function of the differential CNV module. This function is adapted to an anndata object
as preprocessed by our preprocessing module. If computing differential CNVs on a user-provided
object, the function <cite>find_differential_cnv_precomputed</cite> is used</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>data</strong> – anndata object as preprocessed using our preprocessing module. Must contain</p>
<ul>
<li><p>“X_cnv” in data.obsm: the CNV called using our preprocessin module</p></li>
<li><p>“metamembership” in data.obs: the column with the precomputed metamembership labels</p></li>
<li><p>“chromosome” in data.var.columns: the chromosome to which the gene belongs</p></li>
<li><p>“cnv_called” in data.var.columns: if this gene was used for the infercnv call (see
<cite>cansig._preprocessing</cite> for more details on the CNV calling procedure)</p></li>
<li><p>“start” in data.var.columns: the start position of the gene on the chromosome</p></li>
<li><p>“cnv” in data.uns: a summary of the infercnv run</p></li>
<li><p>“chr_pos” in data.uns[“cnv”]: a dictionary containing the mapping between the chromosome and
the index of the regions in the cnv array</p></li>
</ul>
</li>
<li><p><strong>diff_method</strong> – can be mann-whitney U (mwu) or t-test (ttest), method used to compute the differential
CNV between a cluster and the rest</p></li>
<li><p><strong>correction</strong> – whether to output FDR corrected q values in addition to p values</p></li>
<li><p><strong>subclonal</strong> – whether to call CNVs using smoothing on a subclonal level</p></li>
<li><p><strong>batch_key</strong> – key for the batch id</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><p>a pd.Df containing for the differential CNV results (the index is the mapping as computed in <cite>get_cnv_mapping</cite>).
For each cluster cl</p>
<blockquote>
<div><ul class="simple">
<li><p>”{cl}_pvalues” contains the p values of the test cl vs rest</p></li>
<li><p>”{cl}_perc_{gains/losses}” contains the percentage of cells in the cluster showing
a gain/loss at this region</p></li>
<li><p>”{cl}_rest_{gains/losses}” contains the percentage of cells in all but the cluster
showing a gain/loss at this region</p></li>
<li><p>”{cl}_patients_{gain/loss}” contains the number of patients that have at least one
cell in the cluster that shows a gain/loss in the region</p></li>
<li><p>(optional) “{cl}_qvalues” contains the q values of the test cl vs rest
(only if correction is True)</p></li>
</ul>
</div></blockquote>
</p>
</dd>
</dl>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>this function is only called if computing the differential CNV on an Anndata object
preprocessed using our preprocessing module.</p>
</div>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p><cite>find_differential_cnv_precomputed</cite>, the equivalent function if the anndata object provided
was not preprocessed using our preprocessing module</p>
</div>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="cansig.cnvanalysis.differentialcnvs.find_differential_cnv_precomputed">
<span class="sig-prename descclassname"><span class="pre">cansig.cnvanalysis.differentialcnvs.</span></span><span class="sig-name descname"><span class="pre">find_differential_cnv_precomputed</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">cnv_array</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">DataFrame</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">cl_labels</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">DataFrame</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">diff_method</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Literal</span><span class="p"><span class="pre">[</span></span><span class="s"><span class="pre">'mwu'</span></span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="s"><span class="pre">'ttest'</span></span><span class="p"><span class="pre">]</span></span></span></em>, <em class="sig-param"><span class="n"><span class="pre">correction</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">bool</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">batch_key</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">'batch'</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">DataFrame</span></span></span><a class="headerlink" href="#cansig.cnvanalysis.differentialcnvs.find_differential_cnv_precomputed" title="Permalink to this definition">#</a></dt>
<dd><dl class="simple">
<dt>Equivalent of the <cite>find_differential_cnv</cite> function if no anndata object used for the rest of the</dt><dd><p>analysis was not precomputed using our preprocessing module</p>
</dd>
</dl>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>cnv_array</strong> – pd.Df containing the discretized CNV calls, shape (n_cells, n_regions_called)</p></li>
<li><p><strong>cl_labels</strong> – cluster labels associated with the cnv_array, shape (n_cells, 1)</p></li>
<li><p><strong>diff_method</strong> – can be mann-whitney U (mwu) or t-test (ttest), method used to compute the differential
CNV between a cluster and the rest</p></li>
<li><p><strong>correction</strong> – whether to output FDR corrected q values in addition to p values</p></li>
<li><p><strong>batch_key</strong> – the key to the batch id</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><p>a pd.Df containing for the differential CNV results. For each cluster cl</p>
<blockquote>
<div><ul class="simple">
<li><p>”{cl}_pvalues” contains the p values of the test cl vs rest</p></li>
<li><p>”{cl}_perc_{gains/losses}” contains the percentage of cells in the cluster showing a
gain/loss at this region</p></li>
<li><p>”{cl}_rest_{gains/losses}” contains the percentage of cells in all but the cluster showing a
gain/loss at this region</p></li>
<li><p>”{cl}_patients_{gain/loss}” contains the number of patients that have at least one
cell in the cluster that shows a gain/loss in the region</p></li>
<li><p>(optional) “{cl}_qvalues” contains the q values of the test cl vs rest
(only if correction is True)</p></li>
</ul>
</div></blockquote>
</p>
</dd>
</dl>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>this function is only called if computing the differential CNV on an Anndata object
preprocessed using our preprocessing module.</p>
</div>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p><cite>find_differential_cnv_precomputed</cite>, the equivalent function if the anndata object provided
was not preprocessed using our preprocessing module</p>
</div>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="cansig.cnvanalysis.differentialcnvs.get_cluster_labels">
<span class="sig-prename descclassname"><span class="pre">cansig.cnvanalysis.differentialcnvs.</span></span><span class="sig-name descname"><span class="pre">get_cluster_labels</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">data</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">AnnData</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">cluster_key</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">'metamembership'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">batch_key</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">'batch'</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">DataFrame</span></span></span><a class="headerlink" href="#cansig.cnvanalysis.differentialcnvs.get_cluster_labels" title="Permalink to this definition">#</a></dt>
<dd><p>Gets the cluster labels precomputed in the anndata object and batch key</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>data</strong> – anndata object with precomputed cluster labels and CNV calls</p></li>
<li><p><strong>cluster_key</strong> – key for the cluster labels in the .obs of the adata</p></li>
<li><p><strong>batch_key</strong> – key for the batch ID in the .obs of the data</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>pd.Df with the cluster labels and batch id for each cell</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="cansig.cnvanalysis.differentialcnvs.get_cnv_mapping">
<span class="sig-prename descclassname"><span class="pre">cansig.cnvanalysis.differentialcnvs.</span></span><span class="sig-name descname"><span class="pre">get_cnv_mapping</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">data</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">AnnData</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#cansig.cnvanalysis.differentialcnvs.get_cnv_mapping" title="Permalink to this definition">#</a></dt>
<dd><dl class="simple">
<dt>Computes the mapping between the CNV regions called in our preprocessing module</dt><dd><p>and the genes used for the computation of the CNV call.</p>
</dd>
</dl>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>data</strong> – anndata object as preprocessed using our preprocessing module. Must contain</p>
<ul class="simple">
<li><p>“chromosome” in data.var.columns: the chromosome to which the gene belongs</p></li>
<li><p>“cnv_called” in data.var.columns: if this gene was used for the infercnv call (see
<cite>cansig._preprocessing</cite> for more details on the CNV calling procedure)</p></li>
<li><p>“start” in data.var.columns: the start position of the gene on the chromosome</p></li>
<li><p>“cnv” in data.uns: a summary of the infercnv run</p></li>
<li><p>“chr_pos” in data.uns[“cnv”]: a dictionary containing the mapping between the chromosome and
the index of the regions in the cnv array</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>the name of the regions as “chrXXX;gene1;gene2;…;gene_step”</p>
</dd>
<dt class="field-odd">Raises<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>ValueError</strong> – if the data object doesn’t fit the above mentioned criteria (this is automatic
    if the data object was processed using our preprocessing module)</p>
</dd>
</dl>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>this function is only called if computing the differential CNV on an Anndata object
preprocessed using our preprocessing module. If using an external CNV array, we assume
you have your own mapping for the regions you are using</p>
</div>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="cansig.cnvanalysis.differentialcnvs.get_cnv_results_pc">
<span class="sig-prename descclassname"><span class="pre">cansig.cnvanalysis.differentialcnvs.</span></span><span class="sig-name descname"><span class="pre">get_cnv_results_pc</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">cl_labels</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">DataFrame</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">cnv_array</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">DataFrame</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">diff_function</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">cluster_key</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">'metamembership'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">batch_key</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">'batch'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">clusters_to_exclude</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">List</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">]</span></span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">['-2.0',</span> <span class="pre">'outlier']</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">DefaultDict</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">List</span><span class="p"><span class="pre">]</span></span></span></span><a class="headerlink" href="#cansig.cnvanalysis.differentialcnvs.get_cnv_results_pc" title="Permalink to this definition">#</a></dt>
<dd></dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="cansig.cnvanalysis.differentialcnvs.get_diff_cnv">
<span class="sig-prename descclassname"><span class="pre">cansig.cnvanalysis.differentialcnvs.</span></span><span class="sig-name descname"><span class="pre">get_diff_cnv</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">cnv_array</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">DataFrame</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">cl_labels</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">DataFrame</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">diff_method</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Literal</span><span class="p"><span class="pre">[</span></span><span class="s"><span class="pre">'mwu'</span></span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="s"><span class="pre">'ttest'</span></span><span class="p"><span class="pre">]</span></span></span></em>, <em class="sig-param"><span class="n"><span class="pre">correction</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">bool</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">cluster_key</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">'metamembership'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">batch_key</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">'batch'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">clusters_to_exclude</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">List</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">]</span></span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">['-2.0',</span> <span class="pre">'outlier']</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">DataFrame</span></span></span><a class="headerlink" href="#cansig.cnvanalysis.differentialcnvs.get_diff_cnv" title="Permalink to this definition">#</a></dt>
<dd><p>Computes the differential CNVs between a cluster and the rest, for all clusters</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>cnv_array</strong> – pd.Df containing the discretized CNV calls, either through <cite>discretize_cnv</cite>,
<cite>get_subclonal_cnv</cite> or precomputed if the CNVs were not called using our preprocessing module
shape (n_cells, n_regions_called)</p></li>
<li><p><strong>cl_labels</strong> – cluster labels and batch id associated with the cnv_array, either computed using <cite>get_cluster_labels</cite>
or precomputed if the CNVs were not called using our preprocessing module
shape (n_cells, 2)</p></li>
<li><p><strong>diff_method</strong> – can be mann-whitney U (mwu) or t-test (ttest), method used to compute the differential
CNV between a cluster and the rest</p></li>
<li><p><strong>correction</strong> – whether to output FDR corrected q values in addition to p values</p></li>
<li><p><strong>cluster_key</strong> – key for the cluster labels</p></li>
<li><p><strong>batch_key</strong> – key for the batch ID</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><p>a pd.Df containing for the differential CNV results. For each cluster cl</p>
<blockquote>
<div><ul class="simple">
<li><p>”{cl}_pvalues” contains the p values of the test cl vs rest</p></li>
<li><p>”{cl}_perc_{gains/losses}” contains the percentage of cells in the cluster showing a
gain/loss at this region</p></li>
<li><p>”{cl}_rest_{gains/losses}” contains the percentage of cells in all but the cluster showing a
gain/loss at this region</p></li>
<li><p>(optional) “{cl}_qvalues” contains the q values of the test cl vs rest
(only if correction is True)</p></li>
</ul>
</div></blockquote>
</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="cansig.cnvanalysis.differentialcnvs.get_subclonal_cnv">
<span class="sig-prename descclassname"><span class="pre">cansig.cnvanalysis.differentialcnvs.</span></span><span class="sig-name descname"><span class="pre">get_subclonal_cnv</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">data</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">AnnData</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">cnv_key</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">'X_cnv'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">subclonal_key</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">'subclonal'</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">DataFrame</span></span></span><a class="headerlink" href="#cansig.cnvanalysis.differentialcnvs.get_subclonal_cnv" title="Permalink to this definition">#</a></dt>
<dd><p>Homogeneizes the CNV on a subclonal level rather than on a cell level. The CNV call for a cell will
be computed through a majority voting of the subclone it belongs to.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>data</strong> – anndata object with precomputed cluster labels and CNV calls</p></li>
<li><p><strong>cnv_key</strong> – key for the called CNV calls in the .obsm of data</p></li>
<li><p><strong>subclonal_key</strong> – key for the subclone ID called through infercnvpy during preprocessing</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>cnv array discretized and homogeneized to a subclone level</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="cansig.cnvanalysis.differentialcnvs.save_diffcnv">
<span class="sig-prename descclassname"><span class="pre">cansig.cnvanalysis.differentialcnvs.</span></span><span class="sig-name descname"><span class="pre">save_diffcnv</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">diffCNVs</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">DataFrame</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">output_file</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Path</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">None</span></span></span><a class="headerlink" href="#cansig.cnvanalysis.differentialcnvs.save_diffcnv" title="Permalink to this definition">#</a></dt>
<dd><p>Helper function to save the differential CNV results</p>
</dd></dl>

</section>
<section id="module-cansig.cnvanalysis">
<span id="module-contents"></span><h2>Module contents<a class="headerlink" href="#module-cansig.cnvanalysis" title="Permalink to this heading">#</a></h2>
<p>The submodule for running the differential CNV analysis.</p>
</section>
</section>


            </article>
            
            
            
            <footer class="bd-footer-article">
                <!-- Previous / next buttons -->
<div class='prev-next-area'>
</div>
            </footer>
            
          </div>
          
          
          
            <div class="bd-sidebar-secondary bd-toc">
              
<div class="toc-item">
  
<div class="tocsection onthispage">
    <i class="fa-solid fa-list"></i> On this page
</div>
<nav id="bd-toc-nav" class="page-toc">
    <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#submodules">
   Submodules
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#module-cansig.cnvanalysis.differentialcnvs">
   cansig.cnvanalysis.differentialcnvs module
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#cansig.cnvanalysis.differentialcnvs.discretize_cnv">
     <code class="docutils literal notranslate">
      <span class="pre">
       discretize_cnv()
      </span>
     </code>
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#cansig.cnvanalysis.differentialcnvs.find_differential_cnv">
     <code class="docutils literal notranslate">
      <span class="pre">
       find_differential_cnv()
      </span>
     </code>
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#cansig.cnvanalysis.differentialcnvs.find_differential_cnv_precomputed">
     <code class="docutils literal notranslate">
      <span class="pre">
       find_differential_cnv_precomputed()
      </span>
     </code>
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#cansig.cnvanalysis.differentialcnvs.get_cluster_labels">
     <code class="docutils literal notranslate">
      <span class="pre">
       get_cluster_labels()
      </span>
     </code>
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#cansig.cnvanalysis.differentialcnvs.get_cnv_mapping">
     <code class="docutils literal notranslate">
      <span class="pre">
       get_cnv_mapping()
      </span>
     </code>
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#cansig.cnvanalysis.differentialcnvs.get_cnv_results_pc">
     <code class="docutils literal notranslate">
      <span class="pre">
       get_cnv_results_pc()
      </span>
     </code>
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#cansig.cnvanalysis.differentialcnvs.get_diff_cnv">
     <code class="docutils literal notranslate">
      <span class="pre">
       get_diff_cnv()
      </span>
     </code>
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#cansig.cnvanalysis.differentialcnvs.get_subclonal_cnv">
     <code class="docutils literal notranslate">
      <span class="pre">
       get_subclonal_cnv()
      </span>
     </code>
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#cansig.cnvanalysis.differentialcnvs.save_diffcnv">
     <code class="docutils literal notranslate">
      <span class="pre">
       save_diffcnv()
      </span>
     </code>
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#module-cansig.cnvanalysis">
   Module contents
  </a>
 </li>
</ul>

</nav>
</div>

<div class="toc-item">
  
<div id="searchbox"></div>
</div>

<div class="toc-item">
  
</div>

<div class="toc-item">
  
<div class="tocsection sourcelink">
    <a href="../_sources/source/cansig.cnvanalysis.rst.txt">
        <i class="fa-solid fa-file-lines"></i> Show Source
    </a>
</div>

</div>

            </div>
          
          
        </div>
        <footer class="bd-footer-content">
          <div class="bd-footer-content__inner">
            
          </div>
        </footer>
        
      </main>
    </div>
  </div>

  
    
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../_static/scripts/bootstrap.js?digest=796348d33e8b1d947c94"></script>
<script src="../_static/scripts/pydata-sphinx-theme.js?digest=796348d33e8b1d947c94"></script>

  <footer class="bd-footer"><div class="bd-footer__inner container">
  
  <div class="footer-item">
    
<p class="copyright">

    &copy; Copyright 2022 CanSig team.<br>

</p>

  </div>
  
  <div class="footer-item">
    <p class="theme-version">
    Built with the
    <a href="https://pydata-sphinx-theme.readthedocs.io/en/stable/index.html">
        PyData Sphinx Theme
    </a>
    0.12.0.
</p>
  </div>
  
  <div class="footer-item">
    
<p class="sphinx-version">
Created using <a href="http://sphinx-doc.org/">Sphinx</a> 5.3.0.<br>
</p>

  </div>
  
</div>
  </footer>
  </body>
</html>